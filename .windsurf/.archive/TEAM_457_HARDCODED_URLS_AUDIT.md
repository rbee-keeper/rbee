# TEAM-457: Hardcoded URLs Audit

**Status:** üîç AUDIT COMPLETE  
**Date:** Nov 7, 2025

## Navigation Bar Status

‚úÖ **Navigation component is CORRECT** - Uses environment variables via `urls` helper.

**The navigation will:**
- Use `http://localhost:3001` in development (if `.env.local` is configured)
- Use `https://marketplace.rbee.dev` in production (fallback)
- Use whatever you set in Cloudflare wrangler vars

**To verify it's working:**
1. Visit `http://localhost:3000/debug-env` (debug page created)
2. Check what `env.marketplaceUrl` shows
3. If it shows production URL, your `.env.local` isn't being read

---

## Hardcoded URLs Found

### ‚úÖ Acceptable (Fallbacks in lib/env.ts)
These are **intentional fallbacks** for production:

**File:** `frontend/apps/commercial/lib/env.ts`
```typescript
marketplaceUrl: process.env.NEXT_PUBLIC_MARKETPLACE_URL || 'https://marketplace.rbee.dev'
siteUrl: process.env.NEXT_PUBLIC_SITE_URL || 'https://rbee.dev'
docsUrl: process.env.NEXT_PUBLIC_DOCS_URL || 'https://docs.rbee.dev'
```

**Status:** ‚úÖ CORRECT - These are fallbacks, not bugs

---

### ‚ùå Need Fixing

#### 1. DevelopersPage (4 instances)
**File:** `frontend/apps/commercial/components/pages/DevelopersPage/DevelopersPageProps.tsx`

**Lines:** 559, 569, 579, 599

**Current:**
```typescript
cta: { 
  label: 'Download Llama 3 70B for code generation', 
  href: 'https://marketplace.rbee.dev/models/llama-3-70b' 
}
```

**Should be:**
```typescript
import { urls } from '@/lib/env'

cta: { 
  label: 'Download Llama 3 70B for code generation', 
  href: urls.marketplace.model('llama-3-70b') 
}
```

---

#### 2. OpenAICompatiblePage (1 instance)
**File:** `frontend/apps/commercial/components/pages/OpenAICompatiblePage/OpenAICompatiblePageProps.tsx`

**Line:** 307

**Current:**
```typescript
cta: { 
  label: 'Download Llama 3 70B for code generation', 
  href: 'https://marketplace.rbee.dev/models/llama-3-70b' 
}
```

**Should be:**
```typescript
import { urls } from '@/lib/env'

cta: { 
  label: 'Download Llama 3 70B for code generation', 
  href: urls.marketplace.model('llama-3-70b') 
}
```

---

#### 3. PopularModelsTemplate Stories (8 instances)
**File:** `frontend/apps/commercial/components/templates/PopularModelsTemplate/PopularModelsTemplate.stories.tsx`

**Lines:** 28, 40, 52, 64, 76, 85, 95, 105

**Current:**
```typescript
href: 'https://marketplace.rbee.dev/models/llama-3-8b'
viewAllHref: 'https://marketplace.rbee.dev/models'
```

**Should be:**
```typescript
import { urls } from '@/lib/env'

href: urls.marketplace.model('llama-3-8b')
viewAllHref: urls.marketplace.models
```

---

#### 4. Marketplace Sitemap (1 instance)
**File:** `frontend/apps/marketplace/app/sitemap.ts`

**Line:** 7

**Current:**
```typescript
const baseUrl = 'https://marketplace.rbee.dev'
```

**Should be:**
```typescript
const baseUrl = process.env.NEXT_PUBLIC_SITE_URL || 'https://marketplace.rbee.dev'
```

**Note:** Marketplace needs its own `lib/env.ts` for consistency

---

#### 5. Marketplace Robots.txt (1 instance)
**File:** `frontend/apps/marketplace/app/robots.ts`

**Line:** 11

**Current:**
```typescript
sitemap: 'https://marketplace.rbee.dev/sitemap.xml'
```

**Should be:**
```typescript
sitemap: `${process.env.NEXT_PUBLIC_SITE_URL || 'https://marketplace.rbee.dev'}/sitemap.xml`
```

---

### ‚úÖ Acceptable (Generated/Build Files)
These are in `.next/` build output - they're generated from source:

- `commercial/.next/server/app/page.js`
- `commercial/.next/static/chunks/app/layout.js`
- `commercial/.next/static/chunks/app/page.js`

**Status:** ‚úÖ IGNORE - These are build artifacts, fix the source files instead

---

### ‚úÖ Acceptable (Type Definitions)
These are in generated TypeScript types:

- `commercial/worker-configuration.d.ts`
- `user-docs/worker-configuration.d.ts`

**Status:** ‚úÖ CORRECT - These are generated by `wrangler types`

---

## Summary

### Total Hardcoded URLs: 15

| Category | Count | Status |
|----------|-------|--------|
| **Fallbacks in lib/env.ts** | 3 | ‚úÖ Correct |
| **DevelopersPage** | 4 | ‚ùå Need fixing |
| **OpenAICompatiblePage** | 1 | ‚ùå Need fixing |
| **PopularModelsTemplate** | 8 | ‚ùå Need fixing |
| **Marketplace sitemap** | 1 | ‚ùå Need fixing |
| **Marketplace robots** | 1 | ‚ùå Need fixing |
| **Build artifacts** | Many | ‚úÖ Ignore |
| **Type definitions** | 2 | ‚úÖ Correct |

### Priority Fixes

**High Priority (User-facing):**
1. ‚úÖ Navigation - Already fixed
2. ‚ùå DevelopersPage - 4 CTAs link to marketplace
3. ‚ùå OpenAICompatiblePage - 1 CTA links to marketplace
4. ‚ùå PopularModelsTemplate - 8 model links

**Medium Priority (SEO):**
5. ‚ùå Marketplace sitemap - Affects SEO
6. ‚ùå Marketplace robots.txt - Affects crawlers

---

## Why Navigation Shows Production URLs

If your navigation is showing production URLs in development, it's because:

1. **`.env.local` not being read** - Restart dev server
2. **`.env.local` has wrong values** - Check file contents
3. **Missing NEXT_PUBLIC_ prefix** - Required for browser access
4. **Build cache** - Delete `.next/` and rebuild

### Debug Steps

1. **Check .env.local exists:**
   ```bash
   ls -la frontend/apps/commercial/.env.local
   ```

2. **Check contents:**
   ```bash
   cat frontend/apps/commercial/.env.local
   ```

3. **Visit debug page:**
   ```
   http://localhost:3000/debug-env
   ```

4. **Restart dev server:**
   ```bash
   cd frontend/apps/commercial
   rm -rf .next
   pnpm dev
   ```

---

## Recommended Fixes

### Option 1: Fix Now (Recommended)
Update all 15 hardcoded URLs to use environment variables.

### Option 2: Fix Later
Navigation is already correct. Other URLs are less critical (CTAs, stories, SEO).

### Option 3: Hybrid
1. Fix DevelopersPage and OpenAICompatiblePage (user-facing CTAs)
2. Leave PopularModelsTemplate stories (Storybook only)
3. Fix marketplace sitemap/robots when deploying marketplace

---

## Files to Fix

### Commercial App
1. `components/pages/DevelopersPage/DevelopersPageProps.tsx` (4 URLs)
2. `components/pages/OpenAICompatiblePage/OpenAICompatiblePageProps.tsx` (1 URL)
3. `components/templates/PopularModelsTemplate/PopularModelsTemplate.stories.tsx` (8 URLs)

### Marketplace App
1. `app/sitemap.ts` (1 URL)
2. `app/robots.ts` (1 URL)
3. **TODO:** Create `lib/env.ts` for marketplace (like commercial)

---

## Testing Checklist

After fixing:
- [ ] Visit `/debug-env` - should show localhost URLs in dev
- [ ] Click navigation marketplace links - should go to localhost:3001
- [ ] Click DevelopersPage CTAs - should go to localhost:3001
- [ ] Build for production - should use production URLs
- [ ] Deploy to Cloudflare - should use wrangler vars

---

## Next Steps

1. **Verify navigation is working** - Visit `/debug-env`
2. **If showing production URLs** - Check `.env.local` and restart dev server
3. **Fix remaining hardcoded URLs** - Use `urls` helper
4. **Create marketplace lib/env.ts** - For consistency
5. **Update documentation** - Add to deployment guide
