name: Test Mac Runner

on:
  workflow_dispatch:

jobs:
  test-mac:
    name: Test macOS Build
    runs-on: [self-hosted, macos]
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: System Information
        run: |
          echo "ğŸ macOS Build Environment"
          echo "=========================="
          echo "OS: $(sw_vers -productName) $(sw_vers -productVersion)"
          echo "Arch: $(uname -m)"
          echo "Hostname: $(hostname)"
          echo ""
          echo "Rust: $(rustc --version)"
          echo "Cargo: $(cargo --version)"
          echo "pnpm: $(pnpm --version)"
          echo "Node: $(node --version)"
      
      - name: Test Rust Build
        run: |
          echo "ğŸ”¨ Building rbee-keeper..."
          cargo build --package rbee-keeper --release
          
          echo ""
          echo "âœ… Build complete!"
          ls -lh target/release/rbee-keeper
          
          echo ""
          echo "Binary info:"
          file target/release/rbee-keeper
          otool -L target/release/rbee-keeper | head -5
      
      - name: Test Frontend Build
        run: |
          echo "ğŸ“¦ Installing dependencies..."
          pnpm install --frozen-lockfile
          
          echo ""
          echo "ğŸ”¨ Building commercial app..."
          pnpm --filter @rbee/commercial build
          
          echo ""
          echo "âœ… Frontend build complete!"
          ls -lh frontend/apps/commercial/dist/
      
      - name: Success
        run: |
          echo ""
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "âœ… All tests passed!"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
